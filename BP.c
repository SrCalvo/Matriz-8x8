/*
  PROYECTO: MATRIZ DE LEDS - BLACKPINK
  AUTOR: Jhonatan Jazael Ontañon Ortiz
  MICROCONTROLADOR: PIC16F887
  COMPILADOR: MikroC PRO for PIC
*/

// --- VARIABLES GLOBALES ---
int i, j, k;

// Arreglo para activar las columnas (potencias de 2)
char PORT_COL[8] = {1, 2, 4, 8, 16, 32, 64, 128};

// Mensaje a mostrar (fuente 8x8)
const char MENSAJE[176] = {
    // B
    0x7E,0x42,0x42,0x42,0x42,0x24,0x00,0x00,
    // L
    0x7E,0x40,0x40,0x40,0x40,0x00,0x00,0x00,
    // A
    0x7E,0x12,0x12,0x12,0x12,0x7E,0x00,0x00,
    // C
    0x3C,0x42,0x42,0x42,0x42,0x24,0x00,0x00,
    // K
    0x7E,0x10,0x28,0x44,0x82,0x00,0x00,0x00,
    // P
    0x7E,0x12,0x12,0x12,0x0C,0x00,0x00,0x00,
    // I
    0x00,0x42,0x7E,0x7E,0x42,0x00,0x00,0x00,
    // N
    0x7E,0x04,0x08,0x10,0x20,0x7E,0x00,0x00,
    // K
    0x7E,0x10,0x28,0x44,0x82,0x00,0x00,0x00,
    // Espacio
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    // I
    0x00,0x42,0x7E,0x7E,0x42,0x00,0x00,0x00,
    // N
    0x7E,0x04,0x08,0x10,0x20,0x7E,0x00,0x00,
    // Espacio
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    // Y
    0x02,0x04,0x78,0x78,0x04,0x02,0x00,0x00,
    // O
    0x3C,0x42,0x42,0x42,0x42,0x3C,0x00,0x00,
    // U
    0x3E,0x40,0x40,0x40,0x40,0x3E,0x00,0x00,
    // R
    0x7E,0x12,0x12,0x32,0x5C,0x00,0x00,0x00,
    // Espacio
    0x00,0x00,0x00,0x00,0x00,0x00,0x00,0x00,
    // A
    0x7E,0x12,0x12,0x12,0x12,0x7E,0x00,0x00,
    // R
    0x7E,0x12,0x12,0x32,0x5C,0x00,0x00,0x00,
    // E
    0x7E,0x4A,0x4A,0x4A,0x42,0x00,0x00,0x00,
    // A
    0x7E,0x12,0x12,0x12,0x12,0x7E,0x00,0x00
};

void main() {

    // Configuración de puertos
    TRISC = 0x00;   // Salida para datos de filas
    TRISD = 0x00;   // Salida para columnas
    ANSEL = 0x00;   // Desactivar entradas analógicas
    ANSELH = 0x00;
    PORTC = 0x00;
    PORTD = 0x00;

    while (1) {

        // Recorre todo el mensaje
        for (i = 0; i < 168; i++) {

            // Control de velocidad
            for (k = 0; k < 25; k++) {

                // Multiplexado (barrido)
                for (j = 0; j < 8; j++) {

                    // Activar columna (solo una en 0, las demás en 1)
                    PORTD = ~PORT_COL[j];

                    // Enviar datos de filas (lógica positiva)
                    PORTC = MENSAJE[i + j];

                    delay_ms(1);

                    // Apagar matriz
                    PORTC = 0x00;
                }
            }
        }

        delay_ms(500);
    }
}
